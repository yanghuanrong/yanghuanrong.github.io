---
title: 地址栏输入URL这个过程发生了什么？
tag: JavaScript
---

# 地址栏输入URL这个过程发生了什么？

在上网冲浪的时候，我们在浏览器中输入了URL，等待了几秒钟甚至更短的时间就出现了我们想看到的内容😍。但这只是表面现象，其实背地里干了很多的事情。

- DNS解析
- TCP链接
- HTTP请求
- 构建DOM树
- 构建CSSOM树
- 生成渲染树
- 合成、绘制

## DNS解析

想要得到对方的MAC地址，需要通过对方的IP地址获取，对方的IP 则需要通过DNS进行解析

 **为什么进行DNS解析？**
 DNS解析就说将网址URL 通过DNS解析成IP地址。DNS就是将域名转化成IP地址的过程

 **系统缓存查询**
 浏览器会调用一个库函数，检测本地的hosts文件（可以认为是电脑本地的一个地址映射文件）,从该文件中查找是否存在该域名对应的IP地址

 **路由器缓存、ISP缓存**
如果系统缓存没有，就会向DNS服务器发送请求，而网络服务一般都会先经过路由器以及网络服务商（电信），所以会先查询路由器缓存，然后再查询ISP的缓存。
> IPS 缓存，本身说一种宽带接入提供商给网页批量访问加速的技术。ISP会将当前访问量较大的网页内容放到ISP服务器的缓存中，当有新的用户请求相同内容时，可以直接从缓存中发送相关信息，不必每次都去访问真正的网站，从而加快了不同用户对相同内容的访问速度，同时也能节省网间流量结算成本。

**DNS递归查询**
如果路由器缓存和ISP的DNS缓存还是没有的话，我们就进行DNS递归查询。从根域名服务器开始查询，然后再到顶级域名服务器，最后到主域名服务器依次查询。
但是这里有两钟查询方式，不仅仅有递归查询的方式，还有一种迭代查询。
> 迭代查询：DNS收到请求时，而不是直接返回查询结果，而是告诉客户端另一台DNS服务器地址。然后客户端再向这台的DNS服务器提交请求，依次循环。

> 递归查询：当DNS服务器收到请求时，就会检查DNS缓存，如果没有就会询问其他服务器，并将返回的查询结果返回客户端。
>
DNS优化，DNS查询经历很多步骤，查询很慢。浏览器获取到IP地址后，一般都会加到浏览器的缓存中，本地的DNS缓存服务器，也可以去记录。
另外使用DNS负载均衡，通常我们的王总应用各种云服务，DNS系统根据每台机器的负载量，地理位置的限制等等，去提供高效的DNS解析服务。

## TCP链接

通过DNS查询到IP地址后，就打算与服务器建立链接，为接下来的数据传输做准备

## HTTP请求

客户端与服务端通过TCP的三次握手建立链接之后，客户端开始向服务端发起请求。服务端接收到客户端的发送的信息，就会返回响应信息和文件。客户端通过状态码来识别当前的响应状态

## 浏览器渲染

**构建DOM**
服务器将HTML、CSS、JS文件转化问二进制数据在网络中传输给浏览器，浏览器通过状态码开始接收、解析文件。
首先浏览器获取HTTP的Request的body中字符串（字符流）的HTML文本，进行解析构建DOM树。
将字符流转化为字符串后，浏览器开始进行词法分析，类似（AST）? 然后转化为 DOM 树。

**构建CSSOM树**
浏览器将HTML文件转化为DOM树，然后进行css样式文件进行解析，构建成CSSOM树，过程和上面类似，但CSSOM树更加耗时

**构建渲染树**
将DOM树和CSSOM树进行合并，生成渲染树，浏览器在生成渲染树的时候，会就会根据渲染树进行布局，调用GPU进行绘制，然后合成图层
